<% layout("/layouts/boilerplate") %>

<div class="filters">
  <!-- Scroll arrows + filter container -->
  <button class="scroll-btn left-btn" id="leftArrow">&#8249;</button>

  <div class="filter-scroll-container" id="scrollableFilters">
    <a href="/listings?category=Trending" class="filter-link">
      <div class="filter" data-category="Trending">
        <div><i class="fa-solid fa-bolt"></i></div>
        <p>Trending</p>
      </div>
    </a>
    <a href="/listings?category=Iconic Cities" class="filter-link">
      <div class="filter" data-category="Iconic Cities">
        <div><i class="fa-solid fa-mountain-city"></i></div>
        <p>Iconic Cities</p>
      </div>
    </a>
    <a href="/listings?category=Villas" class="filter-link">
      <div class="filter" data-category="Villas">
        <div><i class="fa-solid fa-house-chimney"></i></div>
        <p>Villas</p>
      </div>
    </a>
    <a href="/listings?category=Mountains" class="filter-link">
      <div class="filter" data-category="Mountains">
        <div><i class="fa-solid fa-mountain-sun"></i></div>
        <p>Mountains</p>
      </div>
    </a>
    <a href="/listings?category=Mansions" class="filter-link">
      <div class="filter" data-category="Mansions">
        <div><i class="fa-solid fa-landmark"></i></div>
        <p>Mansions</p>
      </div>
    </a>
    <a href="/listings?category=Poolside" class="filter-link">
      <div class="filter" data-category="Poolside">
        <div><i class="fa-solid fa-person-swimming"></i></div>
        <p>Poolside</p>
      </div>
    </a>
    <a href="/listings?category=Glamping" class="filter-link">
      <div class="filter" data-category="Glamping">
        <div><i class="fa-solid fa-campground"></i></div>
        <p>Glamping</p>
      </div>
    </a>
    <a href="/listings?category=Rural Retreats" class="filter-link">
      <div class="filter" data-category="Rural Retreats">
        <div><i class="fa-solid fa-seedling"></i></div>
        <p>Rural Retreats</p>
      </div>
    </a>
    <a href="/listings?category=Snow Escapes" class="filter-link">
      <div class="filter" data-category="Snow Escapes">
        <div><i class="fa-solid fa-person-skiing"></i></div>
        <p>Snow Escapes</p>
      </div>
    </a>
    <a href="/listings?category=The Riviera" class="filter-link">
      <div class="filter" data-category="The Riviera">
        <div><i class="fa-solid fa-champagne-glasses"></i></div>
        <p>The Riviera</p>
      </div>
    </a>
    <a href="/listings?category=Luxe" class="filter-link">
      <div class="filter" data-category="Luxe">
        <div><i class="fa-solid fa-crown"></i></div>
        <p>Luxe</p>
      </div>
    </a>
  </div>

  <button class="scroll-btn right-btn" id="rightArrow">&#8250;</button>

  <div class="tax-toggle">
    <div class="form-check-reverse form-switch">
      <input class="form-check-input" type="checkbox" id="tax-toggle-switch">
      <label class="form-check-label" for="tax-toggle-switch">Display total after taxes</label>
    </div>
  </div>
</div>

<!-- Listing Cards -->
<div class="row row-cols-lg-3 row-cols-md-2 row-cols-sm-1 mt-3">
  <% for(let listing of allListings) { %>
  <a href="/listings/<%=listing._id%>" class="listing-link">
    <div class="card col listing-card">
      <img src="<%= listing.images && listing.images.length > 0 ? listing.images[0].url : '/images/default.jpg' %>"
           class="card-img-top" alt="listing_images" />
      <div class="card-img-overlay"></div>
      <div class="card-body">
        <p class="card-text">
          <b><%= listing.title %></b><br>
          <span class="price" data-baseprice="<%= listing.price %>">
            ₹<%= listing.price.toLocaleString("en-IN") %>
          </span> per night
          <i class="tax-info" style="display: none;"> (Incl. GST)</i>
        </p>
      </div>
    </div>
  </a>
  <% } %>
</div>

<script>
  // --- GST Toggle Logic (unchanged)
  const taxSwitch = document.getElementById("tax-toggle-switch");
  const prices = document.querySelectorAll(".price");
  const taxInfos = document.querySelectorAll(".tax-info");

  taxSwitch.addEventListener("change", () => {
    prices.forEach((priceElement, i) => {
      const basePrice = Number(priceElement.dataset.baseprice) || 0;
      const gstRate = basePrice <= 7500 ? 0.12 : 0.18;
      const totalPrice = basePrice * (1 + gstRate);

      if (taxSwitch.checked) {
        priceElement.textContent = `₹${totalPrice.toLocaleString("en-IN", { maximumFractionDigits: 0 })}`;
        taxInfos[i].style.display = "inline";
        taxInfos[i].textContent = ` (Incl. ${gstRate * 100}% GST)`;
      } else {
        priceElement.textContent = `₹${basePrice.toLocaleString("en-IN")}`;
        taxInfos[i].style.display = "none";
      }
    });
  });

  // --- Scroll Buttons Logic (from friend)
  const scrollContainer = document.getElementById("scrollableFilters");
  const leftArrow = document.getElementById("leftArrow");
  const rightArrow = document.getElementById("rightArrow");
  const scrollAmount = window.innerWidth < 768 ? 200 : 250;


  leftArrow.addEventListener("click", () => {
    scrollContainer.scrollBy({ left: -scrollAmount, behavior: "smooth" });
  });
  rightArrow.addEventListener("click", () => {
    scrollContainer.scrollBy({ left: scrollAmount, behavior: "smooth" });
  });

  function updateArrowVisibility() {
    const scrollLeft = scrollContainer.scrollLeft;
    const maxScroll = scrollContainer.scrollWidth - scrollContainer.clientWidth;
    leftArrow.style.display = scrollLeft > 0 ? "inline-block" : "none";
    rightArrow.style.display = scrollLeft < maxScroll ? "inline-block" : "none";
  }

  scrollContainer.addEventListener("scroll", updateArrowVisibility);
  window.addEventListener("load", updateArrowVisibility);
</script>
